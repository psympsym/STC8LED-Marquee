C51 COMPILER V9.60.0.0   KEYSCAN                                                           05/16/2023 20:13:57 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE KEYSCAN
OBJECT MODULE PLACED IN .\Objects\KeyScan.obj
COMPILER INVOKED BY: D:\Keil\C51\BIN\C51.EXE User\src\KeyScan.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\User\inc) DEBUG OBJECT
                    -EXTEND PRINT(.\Listings\KeyScan.lst) OBJECT(.\Objects\KeyScan.obj)

line level    source

   1          /* ---------------------------------- 包含头文件 --------------------------------- */
   2          #include "KeyScan.h"
   3          
   4          /* ---------------------------------- 私有宏定义 --------------------------------- */
   5          #define KEY_TIME 200 // 按键去抖时间
   6          
   7          /* ---------------------------------- 扩展变量 ---------------------------------- */
   8          uint8 Keysign = 0; // 按键标志
   9          
  10          /* ---------------------------------- 私有变量 ---------------------------------- */
  11          uint8 keysign1 = 0; // 按键状态初始化
  12          uint8 keysign2 = 0;
  13          uint8 keysign3 = 0;
  14          uint8 keysign4 = 0;
  15          
  16          uint8 keyt1 = 0; // 按键去抖计时
  17          uint8 keyt2 = 0;
  18          uint8 keyt3 = 0;
  19          uint8 keyt4 = 0;
  20          
  21          /* ----------------------------------- 函数 ----------------------------------- */
  22          /**
  23           * @brief 按键扫描
  24           * @param none
  25           * @note 改变Keysign的值
  26          */
  27          void KeyScan()
  28          {
  29   1          if (key_sr1 == 1) // k1没被按下
  30   1          {
  31   2              keysign1 = 0; // 按键1标志
  32   2              keyt1 = 0;
  33   2          }
  34   1          else if (keysign1 == 0) // k1被按下且标志为0
  35   1          {
  36   2              keyt1++;
  37   2              if (keyt1 >= KEY_TIME) // 按键去抖
  38   2              {
  39   3                  keyt1 = 0;
  40   3                  keysign1 = 1; // 清除标志以防再次进入
  41   3                  Keysign = 1;
  42   3              }
  43   2          }
  44   1      
  45   1          if (key_sr2 == 1) // k2没被按下
  46   1          {
  47   2              keysign2 = 0; // 按键2标志
  48   2              keyt2 = 0;
  49   2          }
  50   1          else if (keysign2 == 0)
  51   1          {
  52   2              keyt2++;
  53   2              if (keyt2 >= KEY_TIME) // 按键去抖
  54   2              {
C51 COMPILER V9.60.0.0   KEYSCAN                                                           05/16/2023 20:13:57 PAGE 2   

  55   3                  keyt2 = 0;
  56   3                  keysign2 = 1; // 清除标志以防再次进入
  57   3                  Keysign = 2;
  58   3              }
  59   2          }
  60   1      
  61   1          if (key_sr3 == 1) // k3没被按下
  62   1          {
  63   2              keysign3 = 0; // 按键3标志
  64   2              keyt3 = 0;
  65   2          }
  66   1          else if (keysign3 == 0)
  67   1          {
  68   2              keyt3++;
  69   2              if (keyt3 >= KEY_TIME) // 按键去抖
  70   2              {
  71   3                  keyt3 = 0;
  72   3                  keysign3 = 1; // 清除标志以防再次进入
  73   3                  Keysign = 3;
  74   3              }
  75   2          }
  76   1      
  77   1          if (key_sr4 == 1) // k4没被按下
  78   1          {
  79   2              keysign4 = 0; // 按键4标志
  80   2              keyt4 = 0;
  81   2          }
  82   1          else if (keysign4 == 0)
  83   1          {
  84   2              keyt4++;
  85   2              if (keyt4 >= KEY_TIME) // 按键去抖
  86   2              {
  87   3                  keyt4 = 0;
  88   3                  keysign4 = 1; // 清除标志以防再次进入
  89   3                  Keysign = 4;
  90   3              }
  91   2          }
  92   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    144    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      9    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
